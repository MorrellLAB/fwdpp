<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>fwdpp: Tutorial 0: Data types in fwdpp</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">fwdpp
   &#160;<span id="projectnumber">0.3.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Tutorial 0: Data types in fwdpp </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This document introduces the fundamental data types for simulations implemented using <b>fwdpp</b>.</p>
<p>The relevant header file defining these types is</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d5/d1d/forward__types_8hpp.html">fwdpp/forward_types.hpp</a>&gt;</span></div>
</div><!-- fragment --><p>This header will be included when you include the main library header via</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../df/df8/diploid_8hh.html">fwdpp/diploid.hh</a>&gt;</span></div>
</div><!-- fragment --><p><b>Note:</b> this document only covers single-population, individual-based simulations in detail.</p>
<h2>Mutation types</h2>
<p>The most basic type determining the behavior of a simulation is a mutation. Any <b>fwdpp</b>-based simulation must define a mutation type that publicy inherits from <a class="el" href="../../d1/da4/structKTfwd_1_1mutation__base.html" title="Base class for mutations At minimum, a mutation must contain a position and a count in the population...">KTfwd::mutation_base</a>. This base class contains several public data types:</p>
<div class="fragment"><div class="line"><span class="comment">//The mutation position</span></div>
<div class="line"><span class="keyword">mutable</span> <span class="keywordtype">double</span> pos;</div>
<div class="line"><span class="comment">//The number of occurrences in the population</span></div>
<div class="line"><span class="keywordtype">unsigned</span> n;</div>
<div class="line"><span class="comment">//Does this mutation affect fitness/trait value?</span></div>
<div class="line"><span class="keywordtype">bool</span> neutral;</div>
<div class="line"><span class="comment">//This is used and updated internally by other functions w/in the library</span></div>
<div class="line"><span class="keywordtype">bool</span> checked;</div>
</div><!-- fragment --><p>This type is usable in a simulation, but not in an interesting simulation, as there is no selection coefficient, etc. In order to add things to a mutation type, you extend <a class="el" href="../../d1/da4/structKTfwd_1_1mutation__base.html" title="Base class for mutations At minimum, a mutation must contain a position and a count in the population...">KTfwd::mutation_base</a> via public inheritance. You may find an example of that in the next tutorial (<a class="el" href="../../d1/d7a/md_md_policies.html">Tutorial 1: Policies in fwdpp</a>) and in the following types provided by the library:</p>
<ul>
<li><a class="el" href="../../d1/d7f/structKTfwd_1_1mutation.html" title="The simplest mutation type, adding just a selection coefficient and dominance to the interface...">KTfwd::mutation</a></li>
<li><a class="el" href="../../dc/dcc/structKTfwd_1_1popgenmut.html" title="Mutations with selection, dominance, and tracking age of origin The &quot;standard&quot; mutation type for popu...">KTfwd::popgenmut</a></li>
</ul>
<h3>Notes</h3>
<ul>
<li>Remember to <em>properly</em> initialize the base class from your derived mutation classes!</li>
<li>All fitness models provided by the library require a mutation type to contain a double called <img class="formulaInl" alt="$s$" src="../../form_5.png"/> representing the selection coefficient (or effect size). For example, see <a class="el" href="../../d0/ddb/structKTfwd_1_1site__dependent__fitness.html" title="Function object for fitness as a function of individual mutations in a diploid. ">KTfwd::site_dependent_fitness</a>. Hoewever, if you write your own fitness models, then your mutations can contain whatever they want.</li>
</ul>
<h2>Mutation lists</h2>
<p>Mutations must be stored in double-linked lists. In the C++ standard library, use std::list:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;list&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../df/df8/diploid_8hh.html">fwdpp/diploid.hh</a>&gt;</span></div>
<div class="line"></div>
<div class="line">std::list&lt; KTfwd::mutation &gt; <a class="code" href="../../dd/d6c/siteDepFitness_8cc.html#a5343ffa32173d1ca8624a7d19e41f658">mlist</a>;</div>
</div><!-- fragment --><p>The standard list type works well, and simulations will be pretty fast. However, we can do better. In any forward simulations, mutations enter the population and then quickly exit because they are lost due to drift and/or selection. Situations where small objects are coming and going rapidly screams for a memory pool allocation model, rather than the standard allocator that the above code block is implying:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;list&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../df/df8/diploid_8hh.html">fwdpp/diploid.hh</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//This is equivalent to the above block,</span></div>
<div class="line"><span class="comment">//which relies on the default allocator</span></div>
<div class="line"><span class="comment">//being the standard one.</span></div>
<div class="line">std::list&lt; KTfwd::mutation, std::allocator&lt;KTfwd::mutation&gt; &gt; <a class="code" href="../../dd/d6c/siteDepFitness_8cc.html#a5343ffa32173d1ca8624a7d19e41f658">mlist</a>;</div>
</div><!-- fragment --><p>The <a href="http://www.boost.org">boost</a> C++ libraries provide nicely-implemented memory pool objects:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;boost/container/list.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;boost/pool/pool_alloc.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../df/df8/diploid_8hh.html">fwdpp/diploid.hh</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//We see that typedefs lead to improved sanity:</span></div>
<div class="line"><span class="keyword">using</span> mutation_t = <a class="code" href="../../d1/d7f/structKTfwd_1_1mutation.html">KTfwd::mutation</a>;</div>
<div class="line"><span class="keyword">using</span> mutation_t_allocator = boost::pool_allocator&lt;mutation_t&gt;;</div>
<div class="line">boost::container::list&lt; mutation_t, mutation_t_allocator &gt; <a class="code" href="../../dd/d6c/siteDepFitness_8cc.html#a5343ffa32173d1ca8624a7d19e41f658">mlist</a>;</div>
</div><!-- fragment --><p>For simulations with large mutation and/or recombination rates, using the boost types can result is substantially faster simulations. It is well worth it to have boost available on your systems!</p>
<p>Note that you can use the boost allocators with the standard containers, etc.</p>
<p>Further note that I have done <em>zero</em> experimentation with parameters to the pool_allocator template, which itself can be tweaked in various ways.</p>
<h2>Gamete types</h2>
<p>The basic gamete type is <a class="el" href="../../d6/d90/structKTfwd_1_1gamete__base.html" title="Base class for gametes. ">KTfwd::gamete_base</a>, which is a template type. Fundamentally, gametes contain vectors if <em>iterators</em> derived from mutation lists. There is one such vector for "neutral" variants, another for "selected" variants.</p>
<p>In order to instantiate a gamete template, you must provide the mutation type at a minimum:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;list&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../df/df8/diploid_8hh.html">fwdpp/diploid.hh</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using</span> mutation_t = <a class="code" href="../../d1/d7f/structKTfwd_1_1mutation.html">KTfwd::mutation</a>;</div>
<div class="line">std::list&lt; mutation_t &gt; <a class="code" href="../../dd/d6c/siteDepFitness_8cc.html#a5343ffa32173d1ca8624a7d19e41f658">mlist</a>;</div>
<div class="line"><span class="comment">//This defaults to assuming that std::list&lt;mutation_t&gt; is the mutation list type</span></div>
<div class="line"><span class="keyword">using</span> gamete_t = <a class="code" href="../../d6/d90/structKTfwd_1_1gamete__base.html">KTfwd::gamete_base&lt;mutation_t&gt;</a>;</div>
</div><!-- fragment --><p>If your mutation list type is not std::list, then you must provide an additional template parameter:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;boost/container/list.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;boost/pool/pool_alloc.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../df/df8/diploid_8hh.html">fwdpp/diploid.hh</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//We see that typedefs lead to improved sanity:</span></div>
<div class="line"><span class="keyword">using</span> mutation_t = <a class="code" href="../../d1/d7f/structKTfwd_1_1mutation.html">KTfwd::mutation</a>;</div>
<div class="line"><span class="keyword">using</span> mutation_t_allocator = boost::pool_allocator&lt;mutation_t&gt;;</div>
<div class="line"><span class="keyword">using</span> mlist_t = boost::container::list&lt; mutation_t, mutation_t_allocator &gt;;</div>
<div class="line">mlist_t <a class="code" href="../../dd/d6c/siteDepFitness_8cc.html#a5343ffa32173d1ca8624a7d19e41f658">mlist</a>;</div>
<div class="line"><span class="keyword">using</span> gamete_t = <a class="code" href="../../d6/d90/structKTfwd_1_1gamete__base.html">KTfwd::gamete_base&lt;mutation_t,mlist_t&gt;</a>;</div>
</div><!-- fragment --><p>That's basically it for gametes.</p>
<h3>Notes</h3>
<ul>
<li>The interface to Ktfwd::gamete_base is a little funny. Ideally, you should be able to provide only the mutation list type, <em>e.g.</em>,</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">using</span> gamete_t = <a class="code" href="../../d6/d90/structKTfwd_1_1gamete__base.html">KTfwd::gamete_base&lt;mutation_t,mlist_t&gt;</a>;</div>
</div><!-- fragment --><p>The gamete_t should be able to deduce the mutation_t from the mlist_t::value_type. That's all true, but I first wrote the gamete type based around the idea of the mutation and the default std::list&lt;mutation_t&gt;. Changing it now would break all existing simulations using the library.</p>
<ul>
<li>As of <b>fwdpp</b> 0.3.0, <a class="el" href="../../d6/d90/structKTfwd_1_1gamete__base.html" title="Base class for gametes. ">KTfwd::gamete_base</a> takes a third template argument, which currently defaults to <a class="el" href="../../d3/dea/namespaceKTfwd_1_1tags.html#a5d8bb8cb0ad58525e213bf7d6f529dee" title="The &quot;regular&quot; gamete for a diploid simulation. ">KTfwd::tags::standard_gamete</a>. This tag has no effect on anything, and the library remains source-compatible with previous versions. This "tag" is a placeholder for potential future library features making use of tag-dispatch methods for implementing more complex models.</li>
</ul>
<h2>Gamete lists</h2>
<p>Like mutations, gametes are stored in doubly-linked lists. All of the stuff from the section on mutation lists applies here.</p>
<h2>Diploids</h2>
<p>In fwdpp, a diploid is a pair of iterator derived from a gamete list, <em>e.g.</em>,</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> glist_t = std::list&lt;gamete_t&gt;;</div>
<div class="line"><span class="keyword">using</span> <a class="code" href="../../dc/dfb/structdiploid__t.html">diploid_t</a> = std::pair&lt; glist_t::iterator, glist_t::iterator &gt;;</div>
</div><!-- fragment --><p>Then, the entire population is a vector of diploids:</p>
<div class="fragment"><div class="line">std::vector&lt; diploid_t &gt; diploids;</div>
</div><!-- fragment --><h2>What next</h2>
<p>A simulation is implemented as a set of <em>policies</em> that interact with the above data types:</p>
<ul>
<li><a class="el" href="../../d1/d7a/md_md_policies.html">Tutorial 1: Policies in fwdpp</a></li>
</ul>
<p><b>fwdpp</b> 0.3.0 introduced a "sugar" layer of code intended to make simulation development easier:</p>
<ul>
<li><a class="el" href="../../db/dd8/md_md_sugar.html">Tutorial 5: the "sugar" layer on top of fwdpp</a></li>
</ul>
<p>The examples are the best place to look for how simulations are actually implemented:</p>
<ul>
<li><a class="el" href="../../df/dcb/md_md_examples.html">Example programs</a></li>
</ul>
<p>There is some (limited) support for quick-starting projects based on <b>fwdpp</b>:</p>
<ul>
<li><a class="el" href="../../d9/d5d/md_md_devtools.html">Tutorial 4: Starting projects based on fwdpp</a></li>
</ul>
<p>Finally, there are more advanced topics:</p>
<ul>
<li><a class="el" href="../../de/dbc/md_md_multiloc.html">Tutorial 2: Implementing multilocus simulations</a></li>
<li><a class="el" href="../../d5/d9d/md_md_serialization.html">Tutorial 3: Data serialization</a> </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
