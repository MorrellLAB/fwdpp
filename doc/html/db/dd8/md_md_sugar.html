<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>fwdpp: Tutorial 5: the &quot;sugar&quot; layer on top of fwdpp</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">fwdpp
   &#160;<span id="projectnumber">0.4.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Tutorial 5: the "sugar" layer on top of fwdpp </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Through <b>fwdpp</b> 0.2.9, a lot of the basic setup of a simulation could get tedious due to having to define a large number of container types. In version 0.3.0 of the library, I introduced the subdirectory fwdpp/sugar, which is a layer of "syntatic sugar" designed to make fwdpp both easier to use and easier to wrap for use in other programming environments.</p>
<p>These functions are only relevant to <em>indivdual-based</em> simulations. The gamete-based portion of <b>fwdpp</b> is unlikely to be supported (which is fine, as it is slower...).</p>
<h2>Purpose</h2>
<p>The intention of the "sugar layer" is to:</p>
<ul>
<li>Provide a path to more rapid development of simulations, which is accomplished by providing a set of C++11 template aliases for structures defining population objects.</li>
<li>Provide a set of standard mutation types and a standard mutation model policy to support such objects. These types include <a class="el" href="../../d1/d7f/structKTfwd_1_1mutation.html" title="The simplest mutation type, adding just a selection coefficient and dominance to the interface...">KTfwd::mutation</a> (which has been in the library "forever"), <a class="el" href="../../dc/dcc/structKTfwd_1_1popgenmut.html" title="Mutations with selection, dominance, and tracking age of origin The &quot;standard&quot; mutation type for popu...">KTfwd::popgenmut</a>, which is implemented over and over again as mutation_with_age in the examples (<a class="el" href="../../df/dcb/md_md_examples.html">Example programs</a>), and <a class="el" href="../../df/d07/structKTfwd_1_1infsites.html" title="Generic function object implementing the infinitely-many sites mutation model for &quot;standard&quot; populati...">KTfwd::infsites</a>, which implements an infinitely-many sites mutation scheme that can return either of these two types of mutation.</li>
<li>Provide data types wrapping the serialization methods in <b>fwdpp</b> (see <a class="el" href="../../d5/d9d/md_md_serialization.html">Tutorial 3: Data serialization</a>). The relevant sugar components are <a class="el" href="../../d0/d8e/structKTfwd_1_1serialize.html" title="Serialize populations. ">KTfwd::serialize</a> and <a class="el" href="../../d6/dde/structKTfwd_1_1deserialize.html" title="Deserialize population objects. ">KTfwd::deserialize</a>.</li>
<li>Make sure that all types defined in the sugar layer are properly-defined so that they may be used in conjunction with tools like <a href="http://cran.r-project.org/web/packages/Rcpp/index.html">Rcpp</a> to enable running/processing simulations within R, and <a href="http://www.boost.org">boost</a>'s "boost.python" library to enable processing/running simulations in python.</li>
</ul>
<p><b>Note:</b> You may find an example of using <b>fwdpp</b> + Rcpp in <a href="http://github.com/molpopgen/foRward">foRward</a> and an example of using boost.python in the extensions subdirectory of the <b>fwdpp</b> source code repository. I will address the issue of Cython support soon, but am currently finding the C++-related documentation for that project to be, well, horrid.</p>
<h2>Overview</h2>
<p>The sugar layer is comprised of several different headers, all located in <em>fwdpp/sugar</em>. These header files are intended to be used directly for implementing simulations.</p>
<p>Further subdirectories contain the details of the namespace <a class="el" href="../../dd/d0a/namespaceKTfwd_1_1sugar.html" title="Nested namespace for sugar layer. ">KTfwd::sugar</a>, which most library users are unlikely to need to deal with directly.</p>
<p>Importantly, <em>the use of these headers is optional</em>, and may not work for every type of simulation. Much of this is based upon what I've found to work for my own research using <b>fwdpp</b>.</p>
<h2>Components</h2>
<h3>Smart wrapper to GSL random number generators</h3>
<p><b>fwdpp</b> using the <a href="http://gnu.org/software/gsl">GSL</a> for random number generation. The sugar layer provides a smart pointer wrapper around a gsl_rng *. Currently, the only supported rng types are gsl_rng_mt19937 and gsl_rng_taus2.</p>
<p>The wrapper type is <a class="el" href="../../de/d55/classKTfwd_1_1GSLrng__t.html" title="A wrapper around gsl_rng * objects. ">KTfwd::GSLrng_t</a>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../da/dd8/GSLrng__t_8hpp.html">fwdpp/sugar/GSLrng_t.hpp</a>&gt;</span></div>
</div><!-- fragment --><p>To specify the use of the Mersenne twister:</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> <a class="code" href="../../de/d55/classKTfwd_1_1GSLrng__t.html">GSLrng</a> = <a class="code" href="../../de/d55/classKTfwd_1_1GSLrng__t.html">KTfwd::GSLrng_t&lt;KTfwd::GSL_RNG_MT19937&gt;</a>;</div>
<div class="line"><a class="code" href="../../de/d55/classKTfwd_1_1GSLrng__t.html">GSLrng</a> <a class="code" href="../../d6/d4f/sugar__sampling_8cc.html#a886705dc02755fd5f188a640b37b6c8a">rng</a>(101); <span class="comment">//101 is the seed value </span></div>
</div><!-- fragment --><p>The taus generator may be declared like this:</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> <a class="code" href="../../de/d55/classKTfwd_1_1GSLrng__t.html">GSLrng</a> = <a class="code" href="../../de/d55/classKTfwd_1_1GSLrng__t.html">KTfwd::GSLrng_t&lt;KTfwd::GSL_RNG_TAUS2&gt;</a>;</div>
<div class="line"><a class="code" href="../../de/d55/classKTfwd_1_1GSLrng__t.html">GSLrng</a> <a class="code" href="../../d6/d4f/sugar__sampling_8cc.html#a886705dc02755fd5f188a640b37b6c8a">rng</a>(101); <span class="comment">//101 is the seed value </span></div>
</div><!-- fragment --><p>This wrapper has the following properties:</p>
<ul>
<li>It is constructed with an unsigned integer, which will be used as a seed</li>
<li>It is implemented in terms of a std::unique_ptr</li>
<li>It is not copyable</li>
<li>The underlying pointer is retrived via a call to get()</li>
<li>It frees the gsl_rng * upon destruction using <a class="el" href="../../d5/d99/structKTfwd_1_1sugar_1_1gsl__rng__deleter.html" title="Function object to delete a gsl_rng *. ">KTfwd::sugar::gsl_rng_deleter</a></li>
</ul>
<p>The template parameters are of type <a class="el" href="../../d7/d43/structKTfwd_1_1sugar_1_1GSL__RNG__TYPE__TAG.html" title="Dispatch tag for gsl_rng * types. ">KTfwd::sugar::GSL_RNG_TYPE_TAG</a>;</p>
<h3>Built-in "standard" mutation types and models.</h3>
<p><b>fwdpp</b> provides <a class="el" href="../../d1/d7f/structKTfwd_1_1mutation.html" title="The simplest mutation type, adding just a selection coefficient and dominance to the interface...">KTfwd::mutation</a>, which is a "standard" type of variant for a population-genetic simulation. A mutation is association with a selection coefficient, <img class="formulaInl" alt="$s$" src="../../form_18.png"/>, and a dominance coefficient, <img class="formulaInl" alt="$h$" src="../../form_66.png"/>. The typical "popgen" type of simulation assigns traits values <img class="formulaInl" alt="$1$" src="../../form_63.png"/>, <img class="formulaInl" alt="$1+hs$" src="../../form_67.png"/>, and <img class="formulaInl" alt="$1+xs$" src="../../form_68.png"/> (where <img class="formulaInl" alt="$x = 1$" src="../../form_69.png"/> or 2, depending on the particulars) to genotypes <img class="formulaInl" alt="$AA$" src="../../form_70.png"/>, <img class="formulaInl" alt="$Aa$" src="../../form_71.png"/>, and <img class="formulaInl" alt="$aa$" src="../../form_72.png"/>, respectively, where <img class="formulaInl" alt="$a$" src="../../form_53.png"/> represents the mutation.</p>
<p>The sugar layer provides the additional type <a class="el" href="../../dc/dcc/structKTfwd_1_1popgenmut.html" title="Mutations with selection, dominance, and tracking age of origin The &quot;standard&quot; mutation type for popu...">KTfwd::popgenmut</a>, which also tracks <img class="formulaInl" alt="$g$" src="../../form_14.png"/>, the generation in the simulation where the mutation first arose.</p>
<p>The sugar layer also provides <a class="el" href="../../df/d07/structKTfwd_1_1infsites.html" title="Generic function object implementing the infinitely-many sites mutation model for &quot;standard&quot; populati...">KTfwd::infsites</a>, which generates mutations according to an infinitely-many sites scheme. The mutation types that are supported are <a class="el" href="../../d1/d7f/structKTfwd_1_1mutation.html" title="The simplest mutation type, adding just a selection coefficient and dominance to the interface...">KTfwd::mutation</a> and <a class="el" href="../../dc/dcc/structKTfwd_1_1popgenmut.html" title="Mutations with selection, dominance, and tracking age of origin The &quot;standard&quot; mutation type for popu...">KTfwd::popgenmut</a>. I intend <a class="el" href="../../df/d07/structKTfwd_1_1infsites.html" title="Generic function object implementing the infinitely-many sites mutation model for &quot;standard&quot; populati...">KTfwd::infsites</a> to facilitate rapid prototyping of <b>fwdpp</b>-based simulations, and many users may find these mutation-related types sufficient for their own research needs.</p>
<p>The relevant sugar headers are:</p>
<div class="fragment"><div class="line"><span class="comment">//for KTfwd::popgenmut</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d6/d96/popgenmut_8hpp.html">fwdpp/sugar/popgenmut.hpp</a>&gt;</span></div>
<div class="line"><span class="comment">//for KTfwd::infsites</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../dc/d32/infsites_8hpp.html">fwdpp/sugar/infsites.hpp</a>&gt;</span></div>
</div><!-- fragment --><h3>Simplifying the declaration of a population</h3>
<p>The sugar layer greatly simplifies the setup of the various containers needed for a simulation. The typical simulation requires that the programmer define mutation types, gamete types, mutation list types, gamete list types, and diploid vector types. Further, the programmer may choose to use boost's rapid memory allocation pools and use conditional compilation to support systems without boost.</p>
<p>The sugar layer allows you to set up a simulation only having to decide on your mutation type. The types of simulations that are supported are given by the enum type <a class="el" href="../../de/d6e/group__sugar.html#ga6900fb51d7d4e8e89c6ce5f527eb3dad" title="Types of populations supported by sugar layer. ">KTfwd::sugar::FWDPP_SUGAR_POPTYPE</a> and the dispatch tag type <a class="el" href="../../d9/d2b/structKTfwd_1_1sugar_1_1FWDPP__SUGAR__POPTAG.html" title="Dispatch tag template for population types supported by sugar layer. ">KTfwd::sugar::FWDPP_SUGAR_POPTAG</a>.</p>
<p>Let's assume that you want to do a simulation implemented in terms of <a class="el" href="../../dc/dcc/structKTfwd_1_1popgenmut.html" title="Mutations with selection, dominance, and tracking age of origin The &quot;standard&quot; mutation type for popu...">KTfwd::popgenmut</a>. You may set up various types of simulations like this:</p>
<div class="fragment"><div class="line"><span class="comment">//Single population, single locus</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d6/d96/popgenmut_8hpp.html">fwdpp/sugar/popgenmut.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d5/dd9/singlepop_8hpp.html">fwdpp/sugar/singlepop.hpp</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using</span> <a class="code" href="../../d5/d74/classKTfwd_1_1sugar_1_1singlepop.html">poptype</a> = <a class="code" href="../../d5/d74/classKTfwd_1_1sugar_1_1singlepop.html">KTfwd::singlepop&lt;KTfwd::popgenmut&gt;</a>;</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">//Metapopulation, single locus</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d6/d96/popgenmut_8hpp.html">fwdpp/sugar/popgenmut.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../df/dae/metapop_8hpp.html">fwdpp/sugar/metapop.hpp</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using</span> <a class="code" href="../../d5/d74/classKTfwd_1_1sugar_1_1singlepop.html">poptype</a> = <a class="code" href="../../d3/de0/classKTfwd_1_1sugar_1_1metapop.html">KTfwd::metapop&lt;KTfwd::popgenmut&gt;</a>;</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">//Single population, multi locus</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d6/d96/popgenmut_8hpp.html">fwdpp/sugar/popgenmut.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d6/d10/multiloc_8hpp.html">fwdpp/sugar/multiloc.hpp</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using</span> <a class="code" href="../../d5/d74/classKTfwd_1_1sugar_1_1singlepop.html">poptype</a> = <a class="code" href="../../d3/d11/structKTfwd_1_1sugar_1_1multiloc.html">KTfwd::multiloc&lt;KTfwd::popgenmut&gt;</a>;</div>
</div><!-- fragment --><p>The code chunks above will result in the following:</p>
<ul>
<li>All containers are from namespace std</li>
<li>Populations are move-constructible</li>
<li>Populations are <b>not</b> copyable. The copy constructor and assignment operator are both deleted.</li>
</ul>
<p>In order to use boost containers and boost::pool_allocator instead of the std containers, define FWDPP_SUGAR_USE_BOOST for your preprocessor. For example:</p>
<div class="fragment"><div class="line"><span class="comment">//Single population, single locus</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d6/d96/popgenmut_8hpp.html">fwdpp/sugar/popgenmut.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#define FWDPP_SUGAR_USE_BOOST</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../d5/dd9/singlepop_8hpp.html">fwdpp/sugar/singlepop.hpp</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using</span> <a class="code" href="../../d5/d74/classKTfwd_1_1sugar_1_1singlepop.html">poptype</a> = <a class="code" href="../../d5/d74/classKTfwd_1_1sugar_1_1singlepop.html">KTfwd::singlepop&lt;KTfwd::popgenmut&gt;</a>;</div>
</div><!-- fragment --><p>(Note that simulations will typically be a lot faster if you use boost's memory pools!)</p>
<h4>Copyable populations</h4>
<p>There are important use cases that require copyable populations. For example, exposing classes to python using boost.python requires that the underlying C++ types are copy-constructible, and thus the "poptypes" described above will not compile successfully because their copy constructors are deleted for safety.</p>
<p>However, due to the pointer/iterator-based design of <b>fwdpp</b>, such copies require deep copies that reconstruct data structures. Such copies are complex, and can be handled manually via <a class="el" href="../../da/d8b/namespaceKTfwd.html#a373a7cb82b761c6d2a49059031fe69de" title="Write population to binary-format file for individual-based simulations. ">KTfwd::write_binary_pop</a> and <a class="el" href="../../da/d8b/namespaceKTfwd.html#a9e69664068c15f09429f9087144fec7f">KTfwd::write_binary_metapop</a> to <em>write</em> data to an internal buffer (such as std::ostringstream), and <a class="el" href="../../da/d8b/namespaceKTfwd.html#a770312024c111ecd9e065854e527cf86" title="Read the population back from a binary-format file for individual-based simulations. ">KTfwd::read_binary_pop</a> and <a class="el" href="../../da/d8b/namespaceKTfwd.html#aed5dfa35262dd186e117a0c98b7f77fb" title="Read the metapopulation back from a binary-format file for individual-based simulations Read the meta...">KTfwd::read_binary_metapop</a> to <em>read</em> populations from a buffer. These same functions can be used to implement copy constructors and assignment operators for classes representing populations. However, such objects require policies to write and read the simulation's mutation type (see <a class="el" href="../../d5/d9d/md_md_serialization.html">Tutorial 3: Data serialization</a> for how to write such policies for custom mutation types).</p>
<p>Once such serialization policies are implemented, you may use the following types that <em>are</em> copy-constructible and assignable via operator=:</p>
<ul>
<li><a class="el" href="../../de/d6e/group__sugar.html#ga3c14a36024fca3e623f8f5a1af0e5ac1" title="Single locus, single population with serialization. Can be copied, etc. See Tutorial 5: the &quot;sugar&quot; l...">KTfwd::singlepop_serialized</a></li>
<li><a class="el" href="../../de/d6e/group__sugar.html#ga4d358f12780f69e7492e31a195ccda1b" title="Single locus metapopulation simulation with serialization. Can be copied, etc. See Tutorial 5: the &quot;s...">KTfwd::metapop_serialized</a></li>
<li><a class="el" href="../../de/d6e/group__sugar.html#ga00e304e282adf205b833cd0650be439f" title="Single population, multilocus simulation with serialization. Can be copied, etc. See Tutorial 5: the ...">KTfwd::multiloc_serialized</a></li>
</ul>
<p>Now, copy construction will work:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d8/d21/serialization_8hpp.html">fwdpp/sugar/serialization.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#define FWDPP_SUGAR_USE_BOOST</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../d5/dd9/singlepop_8hpp.html">fwdpp/sugar/singlepop.hpp</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using</span> <a class="code" href="../../de/d25/structKTfwd_1_1mutation__writer.html">mwriter</a> = <a class="code" href="../../de/d25/structKTfwd_1_1mutation__writer.html">KTfwd::mutation_writer</a>;</div>
<div class="line"><span class="keyword">using</span> mreader = <a class="code" href="../../d7/d1a/structKTfwd_1_1mutation__reader.html">KTfwd::mutation_reader&lt;KTfwd::popgenmut&gt;</a>;</div>
<div class="line"><span class="keyword">using</span> <a class="code" href="../../d5/d74/classKTfwd_1_1sugar_1_1singlepop.html">poptype</a> = <a class="code" href="../../d9/dee/classKTfwd_1_1sugar_1_1singlepop__serialized.html">KTfwd::singlepop_serialized&lt;KTfwd::popgenmut,mwriter,mreader&gt;</a>;</div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="../../d3/d01/bneck__selection__ind_8cc.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv )</div>
<div class="line">{</div>
<div class="line">        <span class="comment">//N = 100</span></div>
<div class="line">        <a class="code" href="../../d5/d74/classKTfwd_1_1sugar_1_1singlepop.html">poptype</a> pop(100);</div>
<div class="line">        <a class="code" href="../../d5/d74/classKTfwd_1_1sugar_1_1singlepop.html">poptype</a> pop2(pop);</div>
<div class="line">}</div>
</div><!-- fragment --><h4>Details</h4>
<p>These "poptypes" contain all of the types needed to make calls to <a class="el" href="../../da/d8b/namespaceKTfwd.html#ac0adafd1954c805ce66b5f366782a01d">KTfwd::sample_diploid</a>, etc.:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../df/df8/diploid_8hh.html">fwdpp/diploid.hh</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#define FWDPP_SUGAR_USE_BOOST</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../da/dd8/GSLrng__t_8hpp.html">fwdpp/sugar/GSLrng_t.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d5/dd9/singlepop_8hpp.html">fwdpp/sugar/singlepop.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../dc/d32/infsites_8hpp.html">fwdpp/sugar/infsites.hpp</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using</span> mutation_with_age = <a class="code" href="../../dc/dcc/structKTfwd_1_1popgenmut.html">KTfwd::popgenmut</a>;</div>
<div class="line"><span class="keyword">using</span> <a class="code" href="../../de/d25/structKTfwd_1_1mutation__writer.html">mwriter</a> = <a class="code" href="../../de/d25/structKTfwd_1_1mutation__writer.html">KTfwd::mutation_writer</a>;</div>
<div class="line"><span class="keyword">using</span> mreader = <a class="code" href="../../d7/d1a/structKTfwd_1_1mutation__reader.html">KTfwd::mutation_reader&lt;mutation_with_age&gt;</a>;</div>
<div class="line"><span class="keyword">using</span> <a class="code" href="../../d5/d74/classKTfwd_1_1sugar_1_1singlepop.html">poptype</a> = <a class="code" href="../../d5/d74/classKTfwd_1_1sugar_1_1singlepop.html">KTfwd::singlepop&lt;mutation_with_age&gt;</a>;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="../../d3/d01/bneck__selection__ind_8cc.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="../../d5/d74/classKTfwd_1_1sugar_1_1singlepop.html">poptype</a> pop(1000);</div>
<div class="line"></div>
<div class="line">  <a class="code" href="../../de/d55/classKTfwd_1_1GSLrng__t.html">KTfwd::GSLrng_t&lt;KTfwd::GSL_RNG_TAUS2&gt;</a> <a class="code" href="../../d6/d4f/sugar__sampling_8cc.html#a886705dc02755fd5f188a640b37b6c8a">rng</a>(0u);</div>
<div class="line"></div>
<div class="line">  <span class="comment">//Evolve for 10 generations</span></div>
<div class="line">  std::function&lt;double(void)&gt; recmap = std::bind(gsl_rng_uniform,<a class="code" href="../../d6/d4f/sugar__sampling_8cc.html#a886705dc02755fd5f188a640b37b6c8a">rng</a>);</div>
<div class="line">  <span class="keywordflow">for</span>( <span class="keywordtype">unsigned</span> generation= 0 ; generation &lt; 10 ; ++generation )</div>
<div class="line">    {</div>
<div class="line">      <span class="keywordtype">double</span> wbar = <a class="code" href="../../da/d8b/namespaceKTfwd.html#ac0adafd1954c805ce66b5f366782a01d">KTfwd::sample_diploid</a>(<a class="code" href="../../d6/d4f/sugar__sampling_8cc.html#a886705dc02755fd5f188a640b37b6c8a">rng</a>,</div>
<div class="line">                                          &amp;pop.gametes,</div>
<div class="line">                                          &amp;pop.diploids,</div>
<div class="line">                                          &amp;pop.mutations,</div>
<div class="line">                                          1000,</div>
<div class="line">                                          0.005,</div>
<div class="line">                                          std::bind(<a class="code" href="../../df/d07/structKTfwd_1_1infsites.html">KTfwd::infsites</a>(),<a class="code" href="../../d6/d4f/sugar__sampling_8cc.html#a886705dc02755fd5f188a640b37b6c8a">rng</a>,std::placeholders::_1,&amp;pop.mut_lookup,generation,</div>
<div class="line">                                                    0.005,0.,[](gsl_rng * r){<span class="keywordflow">return</span> gsl_rng_uniform(r);},[](gsl_rng * <a class="code" href="../../d4/dba/callbacks_8cc.html#a53b3e4bb1bd287d2150b9c128e15a316">r</a>){<span class="keywordflow">return</span> 0.;},[](gsl_rng * <a class="code" href="../../d4/dba/callbacks_8cc.html#a53b3e4bb1bd287d2150b9c128e15a316">r</a>){<span class="keywordflow">return</span> 0.;}),</div>
<div class="line">                                          std::bind(<a class="code" href="../../d1/d5b/structKTfwd_1_1genetics101.html">KTfwd::genetics101</a>(),std::placeholders::_1,std::placeholders::_2,</div>
<div class="line">                                                    &amp;pop.gametes,</div>
<div class="line">                                                    0., <span class="comment">//no rec</span></div>
<div class="line">                                                    <a class="code" href="../../d6/d4f/sugar__sampling_8cc.html#a886705dc02755fd5f188a640b37b6c8a">rng</a>,</div>
<div class="line">                                                    recmap),</div>
<div class="line">                                          std::bind(KTfwd::insert_at_end&lt;poptype::mutation_t,poptype::mlist_t&gt;,std::placeholders::_1,std::placeholders::_2),</div>
<div class="line">                                          std::bind(KTfwd::insert_at_end&lt;poptype::gamete_t,poptype::glist_t&gt;,std::placeholders::_1,std::placeholders::_2),</div>
<div class="line">                                          std::bind(<a class="code" href="../../dd/de5/structKTfwd_1_1multiplicative__diploid.html">KTfwd::multiplicative_diploid</a>(),std::placeholders::_1,std::placeholders::_2,2.),</div>
<div class="line">                                          std::bind(<a class="code" href="../../d4/de8/structKTfwd_1_1mutation__remover.html">KTfwd::mutation_remover</a>(),std::placeholders::_1,0,2*pop.N));</div>
<div class="line">      <a class="code" href="../../da/d8b/namespaceKTfwd.html#a84e666ea27d38bdfc539ffd23653eaa9">KTfwd::remove_fixed_lost</a>(&amp;pop.mutations,&amp;pop.fixations,&amp;pop.fixation_times,&amp;pop.mut_lookup,generation,2*pop.N);</div>
<div class="line">  }</div>
</div><!-- fragment --><h4>Further customization</h4>
<p>It you aren't happy with how I've set up the "poptypes", you may provide your own typedefs in terms of the following classes:</p>
<ul>
<li><a class="el" href="../../d5/d74/classKTfwd_1_1sugar_1_1singlepop.html" title="Abstraction of what is needed to simulate a single population using an individual-based sampler from ...">KTfwd::sugar::singlepop</a></li>
<li><a class="el" href="../../d9/dee/classKTfwd_1_1sugar_1_1singlepop__serialized.html" title="Abstraction of what is needed to simulate a single population using an individual-based sampler from ...">KTfwd::sugar::singlepop_serialized</a></li>
<li><a class="el" href="../../d3/de0/classKTfwd_1_1sugar_1_1metapop.html" title="Abstraction of what is needed to simulate a metapopulation using an individual-based sampler from fwd...">KTfwd::sugar::metapop</a></li>
<li><a class="el" href="../../d2/d43/classKTfwd_1_1sugar_1_1metapop__serialized.html" title="Abstraction of what is needed to simulate a metapopulation using an individual-based sampler from fwd...">KTfwd::sugar::metapop_serialized</a></li>
<li><a class="el" href="../../d3/d11/structKTfwd_1_1sugar_1_1multiloc.html" title="Abstraction of what is needed to simulate a multilocus simulation using an individual-based sampler f...">KTfwd::sugar::multiloc</a></li>
<li><a class="el" href="../../d0/dc0/structKTfwd_1_1sugar_1_1multiloc__serialized.html" title="Abstraction of what is needed to simulate a multilocus simulation using an individual-based sampler f...">KTfwd::sugar::multiloc_serialized</a></li>
</ul>
<p>You should also be able to publicly inherit them or encapsulate them in the usual ways, if more customization is needed.</p>
<p><b>fwdpp</b> 0.3.1 added support for custom diploid types (see <a class="el" href="../../d2/dcd/md_md_customdip.html">Advanced topics: custom diploid genotypes</a>). The template aliases for population types were updated accordingly:</p>
<div class="fragment"><div class="line"><span class="comment">//In fwdpp 0.3.0:</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> mtype&gt; <span class="keyword">using</span> <a class="code" href="../../d5/d74/classKTfwd_1_1sugar_1_1singlepop.html">singlepop_t</a> = <span class="comment">//something</span></div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">//In 0.3.1, the default diploid_t is a pair of iterators pointing to gametes.</span></div>
<div class="line"><span class="comment">//You may over-ride this by providing your own diploid type.</span></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> <a class="code" href="../../d3/d01/bneck__selection__ind_8cc.html#a4bf33686d51ed468e9bae483e741965a">mtype</a>,</div>
<div class="line">        <span class="keyword">typename</span> <a class="code" href="../../dc/dfb/structdiploid__t.html">diploid_t</a> = std::pair&lt;typename glist_t&lt;mtype&gt;::iterator,</div>
<div class="line">                                       <span class="keyword">typename</span> glist_t&lt;mtype&gt;::iterator&gt; &gt; <span class="keyword">using</span> <a class="code" href="../../d5/d74/classKTfwd_1_1sugar_1_1singlepop.html">singlepop_t</a> = <span class="comment">//something</span></div>
</div><!-- fragment --><h3>Simplifying serializing of simulated data</h3>
<p>The population types discussed above may be serialized using <a class="el" href="../../d0/d8e/structKTfwd_1_1serialize.html" title="Serialize populations. ">KTfwd::serialize</a> and deserialized using <a class="el" href="../../d6/dde/structKTfwd_1_1deserialize.html" title="Deserialize population objects. ">KTfwd::deserialize</a>. The sugar layer also provides <a class="el" href="../../de/d25/structKTfwd_1_1mutation__writer.html" title="Facilitates serialization of mutation types supported by the fwdpp sugar library. ...">KTfwd::mutation_writer</a> and <a class="el" href="../../d1/d7f/structKTfwd_1_1mutation.html" title="The simplest mutation type, adding just a selection coefficient and dominance to the interface...">KTfwd::mutation</a> reader to support the serialization of <a class="el" href="../../d1/d7f/structKTfwd_1_1mutation.html" title="The simplest mutation type, adding just a selection coefficient and dominance to the interface...">KTfwd::mutation</a> and <a class="el" href="../../dc/dcc/structKTfwd_1_1popgenmut.html" title="Mutations with selection, dominance, and tracking age of origin The &quot;standard&quot; mutation type for popu...">KTfwd::popgenmut</a>.</p>
<p>For example:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d8/d21/serialization_8hpp.html">fwdpp/sugar/serialization.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#define FWDPP_SUGAR_USE_BOOST</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../d5/dd9/singlepop_8hpp.html">fwdpp/sugar/singlepop.hpp</a>&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">using</span> <a class="code" href="../../d5/d74/classKTfwd_1_1sugar_1_1singlepop.html">poptype</a> = <a class="code" href="../../d5/d74/classKTfwd_1_1sugar_1_1singlepop.html">KTfwd::singlepop&lt;KTfwd::popgenmut&gt;</a>;</div>
<div class="line"><span class="keyword">using</span> <a class="code" href="../../de/d25/structKTfwd_1_1mutation__writer.html">mwriter</a> = <a class="code" href="../../de/d25/structKTfwd_1_1mutation__writer.html">KTfwd::mutation_writer</a>;</div>
<div class="line"><span class="keyword">using</span> mreader = <a class="code" href="../../d7/d1a/structKTfwd_1_1mutation__reader.html">KTfwd::mutation_reader&lt;KTfwd::popgenmut&gt;</a>;</div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="../../d3/d01/bneck__selection__ind_8cc.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv )</div>
<div class="line">{</div>
<div class="line">        <span class="comment">//N = 100</span></div>
<div class="line">        <a class="code" href="../../d5/d74/classKTfwd_1_1sugar_1_1singlepop.html">poptype</a> pop(100);</div>
<div class="line">        <a class="code" href="../../d0/d8e/structKTfwd_1_1serialize.html">KTfwd::serialize</a> s;</div>
<div class="line">        s(pop,<a class="code" href="../../de/d25/structKTfwd_1_1mutation__writer.html">mwriter</a>);</div>
<div class="line">        <a class="code" href="../../d5/d74/classKTfwd_1_1sugar_1_1singlepop.html">poptype</a> pop2(0);</div>
<div class="line">        <span class="comment">//Copy pop into pop2 via the buffer in s</span></div>
<div class="line">        <a class="code" href="../../d6/dde/structKTfwd_1_1deserialize.html">KTfwd::deserialize</a>()(pop2,s,<a class="code" href="../../dc/dd4/ms__sampling_8cc.html#aaebd18385ab3036c07b4bcbe6be0d305">mreader</a>());</div>
<div class="line">}</div>
</div><!-- fragment --><p>The above will also work with the _serialized versions of the various "poptypes".</p>
<h4>Details</h4>
<p><a class="el" href="../../d0/d8e/structKTfwd_1_1serialize.html" title="Serialize populations. ">KTfwd::serialize</a> contains a std::stringstream called "buffer", which will hold the serialized data. After deserializing, buffer.seekg(0) is called so that you may read from the beginning of the buffer.</p>
<p>You may also use buffer to write to a file:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d8/d21/serialization_8hpp.html">fwdpp/sugar/serialization.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#define FWDPP_SUGAR_USE_BOOST</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../d5/dd9/singlepop_8hpp.html">fwdpp/sugar/singlepop.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;zlib.h&gt;</span></div>
<div class="line"><span class="keyword">using</span> <a class="code" href="../../d5/d74/classKTfwd_1_1sugar_1_1singlepop.html">poptype</a> = <a class="code" href="../../d5/d74/classKTfwd_1_1sugar_1_1singlepop.html">KTfwd::singlepop&lt;KTfwd::popgenmut&gt;</a>;</div>
<div class="line"><span class="keyword">using</span> <a class="code" href="../../de/d25/structKTfwd_1_1mutation__writer.html">mwriter</a> = <a class="code" href="../../de/d25/structKTfwd_1_1mutation__writer.html">KTfwd::mutation_writer</a>;</div>
<div class="line"><span class="keyword">using</span> mreader = <a class="code" href="../../d7/d1a/structKTfwd_1_1mutation__reader.html">KTfwd::mutation_reader&lt;KTfwd::popgenmut&gt;</a>;</div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="../../d3/d01/bneck__selection__ind_8cc.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> ** argv )</div>
<div class="line">{</div>
<div class="line">        <span class="comment">//N = 100</span></div>
<div class="line">        <a class="code" href="../../d5/d74/classKTfwd_1_1sugar_1_1singlepop.html">poptype</a> pop(100);</div>
<div class="line">        <a class="code" href="../../d0/d8e/structKTfwd_1_1serialize.html">KTfwd::serialize</a> s;</div>
<div class="line">        s(pop,<a class="code" href="../../de/d25/structKTfwd_1_1mutation__writer.html">mwriter</a>);</div>
<div class="line">        gzFile gzf = gzopen(<span class="stringliteral">&quot;pop.gz&quot;</span>,<span class="stringliteral">&quot;wb&quot;</span>);</div>
<div class="line">        gzwrite( gzf, s.<a class="code" href="../../d0/d8e/structKTfwd_1_1serialize.html#a01a324dbaaeeac9580cfccf9539b5b9e">buffer</a>.str(), s.<a class="code" href="../../d0/d8e/structKTfwd_1_1serialize.html#a01a324dbaaeeac9580cfccf9539b5b9e">buffer</a>.str().size() );</div>
<div class="line">        gzclose(gzf);</div>
<div class="line">}</div>
</div><!-- fragment --><p>You may use <a class="el" href="../../d0/d8e/structKTfwd_1_1serialize.html" title="Serialize populations. ">KTfwd::serialize</a> and <a class="el" href="../../d6/dde/structKTfwd_1_1deserialize.html" title="Deserialize population objects. ">KTfwd::deserialize</a> for any custom mutation types, once the proper serializing objects are written (see <a class="el" href="../../d5/d9d/md_md_serialization.html">Tutorial 3: Data serialization</a>).</p>
<p>In 0.3.1, <a class="el" href="../../d1/d04/structKTfwd_1_1gzserialize.html">KTfwd::gzserialize</a> and <a class="el" href="../../d2/db3/structKTfwd_1_1gzdeserialize.html">KTfwd::gzdeserialize</a> were added to handle gzipped output and input, respectivel. The interface is similar to the above. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
