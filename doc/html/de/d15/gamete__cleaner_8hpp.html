<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>fwdpp: /home/kevin/src/fwdpp/fwdpp/internal/gamete_cleaner.hpp File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">fwdpp
   &#160;<span id="projectnumber">0.4.9</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_95c40379012e7d63e221456575a6f3b3.html">fwdpp</a></li><li class="navelem"><a class="el" href="../../dir_a6a87f02aeb2d72647729bc5c28d4867.html">internal</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#namespaces">Namespaces</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">gamete_cleaner.hpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;vector&gt;</code><br />
<code>#include &lt;algorithm&gt;</code><br />
<code>#include &lt;type_traits&gt;</code><br />
<code>#include &lt;<a class="el" href="../../d5/d1d/forward__types_8hpp_source.html">fwdpp/forward_types.hpp</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="../../d4/d62/fwd__functional_8hpp_source.html">fwdpp/fwd_functional.hpp</a>&gt;</code><br />
</div>
<p><a href="../../de/d15/gamete__cleaner_8hpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/dbf/structKTfwd_1_1fwdpp__internal_1_1find__fixation.html">KTfwd::fwdpp_internal::find_fixation</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find the first mutation in a gamete that is also a fixation.  <a href="../../d4/dbf/structKTfwd_1_1fwdpp__internal_1_1find__fixation.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d7a/structKTfwd_1_1fwdpp__internal_1_1gamete__cleaner__erase__remove__idiom__wrapper.html">KTfwd::fwdpp_internal::gamete_cleaner_erase_remove_idiom_wrapper</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wrapper for erase/remove idiom.  <a href="../../d9/d7a/structKTfwd_1_1fwdpp__internal_1_1gamete__cleaner__erase__remove__idiom__wrapper.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:da/d8b/namespaceKTfwd"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d8b/namespaceKTfwd.html">KTfwd</a></td></tr>
<tr class="memdesc:da/d8b/namespaceKTfwd"><td class="mdescLeft">&#160;</td><td class="mdescRight">The primary namespace defined by this library. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:de/dbd/namespaceKTfwd_1_1fwdpp__internal"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/dbd/namespaceKTfwd_1_1fwdpp__internal.html">KTfwd::fwdpp_internal</a></td></tr>
<tr class="memdesc:de/dbd/namespaceKTfwd_1_1fwdpp__internal"><td class="mdescLeft">&#160;</td><td class="mdescRight">Nested namespace for nuts and bolts of certain library functions. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a92065764b6bd601b3a54bca1e2b294b8"><td class="memTemplParams" colspan="2">template&lt;typename gcont_t_iterator &gt; </td></tr>
<tr class="memitem:a92065764b6bd601b3a54bca1e2b294b8"><td class="memTemplItemLeft" align="right" valign="top">gcont_t_iterator&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="../../de/dbd/namespaceKTfwd_1_1fwdpp__internal.html#a92065764b6bd601b3a54bca1e2b294b8">KTfwd::fwdpp_internal::next_extant_gamete</a> (gcont_t_iterator beg, gcont_t_iterator end) noexcept</td></tr>
<tr class="memdesc:a92065764b6bd601b3a54bca1e2b294b8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wrapper around std::find_if to find next gamete where n &gt; 0.  <a href="#a92065764b6bd601b3a54bca1e2b294b8">More...</a><br /></td></tr>
<tr class="separator:a92065764b6bd601b3a54bca1e2b294b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a491c3e370a41ceb07d0db61a675f4ae2"><td class="memTemplParams" colspan="2">template&lt;typename gcont_t , typename mcont_t , typename mutation_removal_policy &gt; </td></tr>
<tr class="memitem:a491c3e370a41ceb07d0db61a675f4ae2"><td class="memTemplItemLeft" align="right" valign="top">std::enable_if&lt; std::is_same&lt; mutation_removal_policy, <a class="el" href="../../db/dcf/structKTfwd_1_1remove__nothing.html">KTfwd::remove_nothing</a> &gt;::value &gt;::type&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="../../de/dbd/namespaceKTfwd_1_1fwdpp__internal.html#a491c3e370a41ceb07d0db61a675f4ae2">KTfwd::fwdpp_internal::gamete_cleaner</a> (gcont_t &amp;, const mcont_t &amp;, const std::vector&lt; uint_t &gt; &amp;, const uint_t, const mutation_removal_policy &amp;)</td></tr>
<tr class="memdesc:a491c3e370a41ceb07d0db61a675f4ae2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles removal of indexes to mutations from gametes after sampling Intended use is when std::is_same&lt; mutation_removal_policy, KTfwd::remove_nothing &gt;::type is true. Called by <a class="el" href="../../da/d8b/namespaceKTfwd.html#a9fa8c6fd5d6b79550163c64a6cb0353a">KTfwd::sample_diploid</a>.  <a href="#a491c3e370a41ceb07d0db61a675f4ae2">More...</a><br /></td></tr>
<tr class="separator:a491c3e370a41ceb07d0db61a675f4ae2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5df5cf70b19fe56a50d78009d6c409df"><td class="memTemplParams" colspan="2">template&lt;typename gcont_t , typename fixation_finder , typename idiom_wrapper &gt; </td></tr>
<tr class="memitem:a5df5cf70b19fe56a50d78009d6c409df"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="../../de/dbd/namespaceKTfwd_1_1fwdpp__internal.html#a5df5cf70b19fe56a50d78009d6c409df">KTfwd::fwdpp_internal::gamete_cleaner_details</a> (gcont_t &amp;gametes, const fixation_finder &amp;ff, const idiom_wrapper &amp;iw) noexcept</td></tr>
<tr class="separator:a5df5cf70b19fe56a50d78009d6c409df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a107d34f674ba9b31446d84dcc838c7c2"><td class="memTemplParams" colspan="2">template&lt;typename gcont_t , typename mcont_t , typename mutation_removal_policy &gt; </td></tr>
<tr class="memitem:a107d34f674ba9b31446d84dcc838c7c2"><td class="memTemplItemLeft" align="right" valign="top">std::enable_if&lt; std::is_same&lt; mutation_removal_policy, std::true_type &gt;::value &gt;::type&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="../../de/dbd/namespaceKTfwd_1_1fwdpp__internal.html#a107d34f674ba9b31446d84dcc838c7c2">KTfwd::fwdpp_internal::gamete_cleaner</a> (gcont_t &amp;gametes, const mcont_t &amp;, const std::vector&lt; uint_t &gt; &amp;mcounts, const uint_t twoN, const mutation_removal_policy &amp;)</td></tr>
<tr class="memdesc:a107d34f674ba9b31446d84dcc838c7c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles removal of indexes to mutations from gametes after sampling Intended use is when std::is_same&lt; mutation_removal_policy, KTfwd::true_type &gt;::type is true. Called by <a class="el" href="../../da/d8b/namespaceKTfwd.html#a9fa8c6fd5d6b79550163c64a6cb0353a">KTfwd::sample_diploid</a>.  <a href="#a107d34f674ba9b31446d84dcc838c7c2">More...</a><br /></td></tr>
<tr class="separator:a107d34f674ba9b31446d84dcc838c7c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaaa90238c89b73be5887acf8a5beed73"><td class="memTemplParams" colspan="2">template&lt;typename gcont_t , typename mcont_t , typename mutation_removal_policy &gt; </td></tr>
<tr class="memitem:aaaa90238c89b73be5887acf8a5beed73"><td class="memTemplItemLeft" align="right" valign="top">std::enable_if&lt; !std::is_same&lt; mutation_removal_policy, std::true_type &gt;::value &amp;&amp;!std::is_same&lt; mutation_removal_policy, <a class="el" href="../../db/dcf/structKTfwd_1_1remove__nothing.html">KTfwd::remove_nothing</a> &gt;::value &gt;::type&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="../../de/dbd/namespaceKTfwd_1_1fwdpp__internal.html#aaaa90238c89b73be5887acf8a5beed73">KTfwd::fwdpp_internal::gamete_cleaner</a> (gcont_t &amp;gametes, const mcont_t &amp;mutations, const std::vector&lt; uint_t &gt; &amp;mcounts, const uint_t twoN, const mutation_removal_policy &amp;mp)</td></tr>
<tr class="memdesc:aaaa90238c89b73be5887acf8a5beed73"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles removal of indexes to mutations from gametes after sampling This overload handles truly custom policies, which must take a mutation type as an argument. Called by <a class="el" href="../../da/d8b/namespaceKTfwd.html#a9fa8c6fd5d6b79550163c64a6cb0353a">KTfwd::sample_diploid</a>.  <a href="#aaaa90238c89b73be5887acf8a5beed73">More...</a><br /></td></tr>
<tr class="separator:aaaa90238c89b73be5887acf8a5beed73"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This file handles the "pruning" of fixations from gametes.</p>
<p>Whether or not any pruning happens depends on policies.</p>
<p>Version 0.4.7 of the library made a major change resulting in improved run-time performance, especially for low mutation rates.</p>
<p>Consider the case of neutral mutations occurring at rate mu (per site, per generation). The rate of fixation is also mu. Thus, when mu is low, the rate of fixation is low, and the expected time in generations between fixations is 1/mu. In other words, calling gamete_cleaner every generation is an unnecessary run-time cost. Now, we check if any fixations exist, and return if there are none. We check separately for neutral- and non-neutral fixations.</p>
<p>Naively, we could simply scan the mutations container of the entire simulation for fixations. But, we can do better than that because:</p>
<ol type="1">
<li>Fixations are, by definition, found in all gametes. Thus, it suffices to check the first (extant) gamete.</li>
<li>When we find the first fixation in a gamete, it is by definition the fixation with the smallest position, out of all fixations. We can store its value and use it to look up the first fixation in all of the remaining gametes. Searching for the first fixation in this way avoids cache misses that are unavoidable when we do out-of-order lookups in "mcounts" for the remaining fixations. </li>
</ol>

<p>Definition in file <a class="el" href="../../de/d15/gamete__cleaner_8hpp_source.html">gamete_cleaner.hpp</a>.</p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
